language: cpp
sudo: false

os:
  - linux
  - osx

compiler:
  - clang

env:
    #  - QTVER=511 # Ubuntu only.
    #  - QTVER=521 # OSX and Ubuntu.
  - QTVER=532 # OSX and Ubuntu.
    #  - QTVER=541 # Ubuntu only.
    #  - QTVER=55  # OSX and Ubuntu.

matrix:
  exclude:
    - { os: osx, env: QTVER=511 }
    - { os: osx, env: QTVER=541 }

before_install:
  - if [[ "$TRAVIS_OS_NAME" == osx && $QTVER != 532 ]]; then brew update; fi

install:
  - export SHORT_VER=`echo $QTVER | cut -b1-2`
  - if [[ "$TRAVIS_OS_NAME" == osx && $QTVER != 521 ]]; then brew install qt5; fi
  - if [[ "$TRAVIS_OS_NAME" == osx && $QTVER == 521 ]]; then brew install homebrew/versions/qt52; fi
  - if [[ "$TRAVIS_OS_NAME" == osx && $QTVER != 521 ]]; then brew link --force qt5; fi
  - if [[ "$TRAVIS_OS_NAME" == osx && $QTVER == 521 ]]; then brew link --force homebrew/versions/qt52; fi

before_script:
  - if [[ "$TRAVIS_OS_NAME" == linux ]]; then export QMAKESPEC=linux-clang; fi
  - if [[ "$TRAVIS_OS_NAME" == osx   ]]; then export QMAKESPEC=macx-clang;  fi
  - if [[ "$TRAVIS_OS_NAME" == linux ]]; then . /opt/qt$SHORT_VER/bin/qt$SHORT_VER-env.sh; fi
  - qmake -v
  - qmake -r -Wall -Wlogic -Wparser CONFIG+=debug_and_release QtTest.pro

script:
  - make -j2 #all
    #  - make -C "$TRAVIS_BUILD_DIR-build" -j2 check
    #  - '[ "$TRAVIS_OS_NAME" != osx ] || make -C "$TRAVIS_BUILD_DIR-build/pkg/osx" dmg'

notifications:
  email:
    on_success: always

addons:
  apt:
    sources:
    - beineri/opt-qt$QTVER
    packages:
    - qt53base
    - qt53xmlpatterns
