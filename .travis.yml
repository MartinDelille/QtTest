language: cpp

os:
  - linux
  - osx

compiler:
  - clang
  - gcc

env:
  - QTVER=511 # Ubuntu only.
  - QTVER=521 # OSX and Ubuntu.
  - QTVER=532 # OSX and Ubuntu.
  - QTVER=541 # Ubuntu only.
  - QTVER=55  # OSX and Ubuntu.

matrix:
  exclude:
    - { os: osx, env: QTVER=511 }
    - { os: osx, env: QTVER=541 }

before_install:
  - '[[ "$TRAVIS_OS_NAME" != linux ]] || sudo add-apt-repository -y ppa:beineri/opt-qt$QTVER'
  - '[[ "$TRAVIS_OS_NAME" != linux ]] || sudo apt-get -qy update'
  - '[[ "$TRAVIS_OS_NAME" != osx   || $QTVER == 532 ]] || brew update'

install:
  - export SHORT_VER=`echo $QTVER | cut -b1-2`
  - '[[ "$TRAVIS_OS_NAME" != linux ]] || sudo apt-get -qy install qt${SHORT_VER}base qt${SHORT_VER}xmlpatterns'
  - '[[ "$TRAVIS_OS_NAME" != osx   || $QTVER == 521 ]] || brew install qt5'
  - '[[ "$TRAVIS_OS_NAME" != osx   || $QTVER != 521 ]] || brew install homebrew/versions/qt52'
  - '[[ "$TRAVIS_OS_NAME" != osx   || $QTVER == 521 ]] || brew link --force qt5'
  - '[[ "$TRAVIS_OS_NAME" != osx   || $QTVER != 521 ]] || brew link --force homebrew/versions/qt52'

before_script:
  - if [[ "$TRAVIS_OS_NAME" == linux && "$CXX" == clang++ ]]; then export QMAKESPEC=linux-clang; fi
  - if [[ "$TRAVIS_OS_NAME" == linux && "$CXX" == g++     ]]; then export QMAKESPEC=linux-g++;   fi
  - if [[ "$TRAVIS_OS_NAME" == osx   && "$CXX" == clang++ ]]; then export QMAKESPEC=macx-clang;  fi
  - if [[ "$TRAVIS_OS_NAME" == osx   && "$CXX" == g++     ]]; then export QMAKESPEC=macx-g++;    fi
  - '[[ "$TRAVIS_OS_NAME" != linux ]] || . /opt/qt$SHORT_VER/bin/qt$SHORT_VER-env.sh'
  - qmake -r -Wall -Wlogic -Wparser CONFIG+=debug_and_release QtTest.pro

script:
  - make -j2 #all
    #  - make -C "$TRAVIS_BUILD_DIR-build" -j2 check
    #  - '[ "$TRAVIS_OS_NAME" != osx ] || make -C "$TRAVIS_BUILD_DIR-build/pkg/osx" dmg'

notifications:
  email:
    on_success: always
